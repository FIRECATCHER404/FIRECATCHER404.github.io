<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fractal Drawer</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #111;
  }
  canvas {
    display: block;
    cursor: crosshair;
  }
  button {
    position: fixed;
    top: 10px;
    left: 10px;
    background: #222;
    color: #fff;
    border: none;
    padding: 10px 14px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
  }
</style>
</head>
<body>
<button id="next">Next Iteration</button>
<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const nextBtn = document.getElementById("next");

let drawing = false;
let basePath = [];
let fractalDepth = 0;

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  draw();
}
window.addEventListener("resize", resize);
resize();

canvas.addEventListener("mousedown", e => {
  drawing = true;
  basePath = [[e.offsetX, e.offsetY]];
});
canvas.addEventListener("mousemove", e => {
  if (!drawing) return;
  basePath.push([e.offsetX, e.offsetY]);
  draw();
});
canvas.addEventListener("mouseup", () => drawing = false);

nextBtn.addEventListener("click", () => {
  if (basePath.length < 2) return;
  fractalDepth++;
  draw();
});

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  if (basePath.length < 2) return;

  ctx.strokeStyle = "#0f0";
  ctx.lineWidth = 1;
  drawFractal(basePath, fractalDepth);
}

function drawFractal(path, depth) {
  if (depth === 0) {
    drawPath(path);
    return;
  }

  const newPath = [];
  for (let i = 0; i < path.length - 1; i++) {
    const [x1, y1] = path[i];
    const [x2, y2] = path[i + 1];

    const midX = (x1 + x2) / 2;
    const midY = (y1 + y2) / 2;
    const dx = x2 - x1;
    const dy = y2 - y1;
    const len = Math.sqrt(dx*dx + dy*dy);
    const angle = Math.atan2(dy, dx);

    // Create a small offset point to make a recursive "bump"
    const offset = len * 0.3;
    const bumpX = midX + Math.cos(angle - Math.PI/2) * offset;
    const bumpY = midY + Math.sin(angle - Math.PI/2) * offset;

    newPath.push([x1, y1], [bumpX, bumpY]);
  }
  newPath.push(path[path.length - 1]);

  drawFractal(newPath, depth - 1);
}

function drawPath(path) {
  ctx.beginPath();
  ctx.moveTo(path[0][0], path[0][1]);
  for (let i = 1; i < path.length; i++) {
    ctx.lineTo(path[i][0], path[i][1]);
  }
  ctx.stroke();
}
</script>
</body>
</html>
